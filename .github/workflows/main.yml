name: Authenticate to Google Cloud

on:
  workflow_dispatch:  # Allows manual triggering of the workflow

jobs:
  authenticate:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Check out the repository
    - name: Checkout repository
      uses: actions/checkout@v3

    # Step 2: Write the service account key to a file
    - name: Write GCP service account key to file
      run: |
        mkdir -p $HOME/.config/gcloud
        echo "${{ secrets.GCP_SERVICE_ACCOUNT_KEY }}" > $HOME/.config/gcloud/application_default_credentials.json

    # Step 3: Set up Google Cloud SDK
    - name: Set up Google Cloud SDK
      uses: google-github-actions/setup-gcloud@v2
      with:
        project_id: your-project-id # Replace with your GCP project ID

    # Step 4: Authenticate using the service account key
    - name: Authenticate to Google Cloud
      run: |
        gcloud auth activate-service-account --key-file=$HOME/.config/gcloud/application_default_credentials.json
        gcloud auth list
        echo "Authentication successful!"
